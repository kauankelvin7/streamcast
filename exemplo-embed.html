<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exemplo: StreamCast Embed</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .header {
            background: rgba(255, 255, 255, 0.98);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
        }
        .header h1 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 32px;
        }
        .alert {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .alert-error {
            background: #f8d7da;
            border-left-color: #dc3545;
        }
        .alert-success {
            background: #d4edda;
            border-left-color: #28a745;
        }
        .alert h3 {
            margin-top: 0;
            margin-bottom: 10px;
        }
        .steps {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .steps ol {
            padding-left: 25px;
        }
        .steps li {
            margin: 12px 0;
            line-height: 1.6;
        }
        .steps code {
            background: #f0f0f0;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #e83e8c;
            font-size: 14px;
        }
        .player-wrapper {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }
        .player-wrapper h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
        }
        #streamcast-player {
            width: 100%;
            height: 70vh;
            min-height: 500px;
            border: 4px solid #667eea;
            border-radius: 12px;
            overflow: hidden;
            background: #000;
            position: relative;
        }
        .status {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin: 10px 0;
        }
        .status.loading {
            background: #ffc107;
            color: #000;
        }
        .status.ready {
            background: #28a745;
            color: white;
        }
        .status.error {
            background: #dc3545;
            color: white;
        }
        a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé¨ StreamCast - Exemplo de Embed</h1>
            <div id="status-indicator"></div>
            
            <div class="alert alert-error" id="file-protocol-warning" style="display: none;">
                <h3>‚ö†Ô∏è Arquivo Local Detectado</h3>
                <p>
                    Este arquivo est√° sendo aberto como <code>file:///</code><br>
                    O localStorage <strong>N√ÉO sincroniza</strong> entre <code>file://</code> e <code>http://</code>
                </p>
            </div>
            
            <div class="alert" id="same-origin-info" style="display: none;">
                <h3>üì° Modo: Mesma Origem (Same-Origin)</h3>
                <p>Voc√™ est√° acessando via servidor local. O localStorage est√° sincronizado! ‚úÖ</p>
            </div>
            
            <div class="alert alert-success" id="cross-origin-info" style="display: none;">
                <h3>üåê Modo: Cross-Origin (Outro Site)</h3>
                <p>
                    Para sincroniza√ß√£o cross-origin, voc√™ precisa:
                    <ol style="margin: 10px 0; padding-left: 20px;">
                        <li>Hospedar o StreamCast em um servidor p√∫blico</li>
                        <li>Ou usar a mesma origem (dom√≠nio) para ambos os sites</li>
                    </ol>
                </p>
            </div>
            
            <div class="steps">
                <h3>üìã Como Configurar:</h3>
                <ol>
                    <li>Certifique-se que o servidor est√° rodando: <code>npm run dev</code></li>
                    <li>Acesse o painel admin: <a href="http://localhost:3000" target="_blank">http://localhost:3000</a></li>
                    <li>Clique em <strong>"Admin"</strong> (canto superior direito)</li>
                    <li>V√° para a aba <strong>"Buscar"</strong></li>
                    <li>Busque um filme ou s√©rie (ex: "Homem Aranha", "Breaking Bad")</li>
                    <li>Clique em <strong>"Adicionar √† Playlist"</strong></li>
                    <li>Clique em <strong>"Salvar e Sincronizar"</strong> na parte inferior</li>
                    <li>Volte para esta p√°gina - o v√≠deo deve aparecer automaticamente!</li>
                </ol>
                
                <div class="alert" style="margin-top: 20px;">
                    <strong>üí° Dica:</strong> Se o v√≠deo n√£o aparecer:
                    <ul style="padding-left: 20px; margin-top: 10px;">
                        <li>Abra o Console do navegador (F12) e verifique os logs</li>
                        <li>Recarregue esta p√°gina ap√≥s salvar no admin</li>
                        <li>Certifique-se de estar acessando via <code>http://localhost:3000/exemplo-embed.html</code></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="player-wrapper">
            <h2>Player Incorporado</h2>
            <div id="streamcast-player">
                <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: white; text-align: center; padding: 20px;">
                    <div>
                        <div style="font-size: 48px; margin-bottom: 20px;">‚è≥</div>
                        <div style="font-size: 20px; font-weight: 600;">Carregando StreamCast...</div>
                        <div style="font-size: 14px; color: #999; margin-top: 10px;">Se n√£o carregar, verifique se o servidor est√° rodando</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Detectar protocolo e modo de acesso
        const protocol = window.location.protocol;
        const isFileProtocol = protocol === 'file:';
        const baseUrl = 'http://localhost:3000';
        
        const statusEl = document.getElementById('status-indicator');
        const playerEl = document.getElementById('streamcast-player');
        
        function setStatus(message, type) {
            statusEl.innerHTML = `<span class="status ${type}">${message}</span>`;
        }
        
        // Verificar tipo de acesso
        if (isFileProtocol) {
            document.getElementById('file-protocol-warning').style.display = 'block';
            setStatus('‚ö†Ô∏è Arquivo Local - Sincroniza√ß√£o Limitada', 'error');
            
            playerEl.innerHTML = `
                <div style="padding: 60px; text-align: center; color: white;">
                    <div style="font-size: 64px; margin-bottom: 20px;">‚ö†Ô∏è</div>
                    <h2 style="margin-bottom: 15px; font-size: 28px;">Arquivo Local Detectado</h2>
                    <p style="font-size: 16px; color: #ccc; margin-bottom: 25px;">
                        Para funcionamento correto, abra via servidor HTTP
                    </p>
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin-top: 20px;">
                        <p style="margin-bottom: 10px; font-size: 14px;">Acesse:</p>
                        <a href="${baseUrl}/exemplo-embed.html" style="color: #00bfa6; font-size: 18px; font-weight: 700;">
                            ${baseUrl}/exemplo-embed.html
                        </a>
                    </div>
                </div>
            `;
        } else if (window.location.origin === baseUrl) {
            // Mesma origem - sincroniza√ß√£o perfeita
            document.getElementById('same-origin-info').style.display = 'block';
            setStatus('‚úÖ Conectado - Sincroniza√ß√£o Ativa', 'ready');
            loadEmbed();
        } else {
            // Cross-origin - precisaria de postMessage ou API backend
            document.getElementById('cross-origin-info').style.display = 'block';
            setStatus('üåê Cross-Origin - Configure API para Sincroniza√ß√£o', 'loading');
            loadEmbed();
        }
        
        function loadEmbed() {
            setStatus('‚è≥ Carregando Player...', 'loading');
            
            const iframe = document.createElement('iframe');
            iframe.src = `${baseUrl}?embed=true`;
            iframe.style.cssText = 'width: 100%; height: 100%; border: 0; display: block;';
            iframe.allow = 'autoplay; fullscreen; picture-in-picture; encrypted-media';
            iframe.allowFullscreen = true;
            iframe.referrerPolicy = 'origin';
            
            // Listener para mensagens do iframe
            window.addEventListener('message', (event) => {
                if (event.data?.type === 'STREAMCAST_EMBED_READY') {
                    console.log('‚úÖ StreamCast embed carregado!');
                    setStatus('‚úÖ Player Carregado', 'ready');
                }
            });
            
            iframe.onerror = () => {
                setStatus('‚ùå Erro ao Carregar - Verifique se o servidor est√° rodando', 'error');
                playerEl.innerHTML = `
                    <div style="padding: 60px; text-align: center; color: white;">
                        <div style="font-size: 64px; margin-bottom: 20px;">‚ùå</div>
                        <h2 style="margin-bottom: 15px; font-size: 28px;">Erro ao Carregar</h2>
                        <p style="font-size: 16px; color: #ccc;">
                            Certifique-se que o servidor est√° rodando em:<br>
                            <code style="background: rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 5px;">${baseUrl}</code>
                        </p>
                        <div style="margin-top: 25px;">
                            <button onclick="location.reload()" style="padding: 12px 30px; background: #00bfa6; border: none; border-radius: 8px; color: #000; font-weight: 700; cursor: pointer; font-size: 16px;">
                                Tentar Novamente
                            </button>
                        </div>
                    </div>
                `;
            };
            
            playerEl.innerHTML = '';
            playerEl.appendChild(iframe);
            
            // Timeout de seguran√ßa
            setTimeout(() => {
                if (statusEl.querySelector('.loading')) {
                    console.log('‚úÖ Player embed iniciado (timeout)');
                    setStatus('‚ö° Player em Execu√ß√£o', 'ready');
                }
            }, 3000);
        }
        
        // Log para debug
        console.log('üìç Protocolo:', protocol);
        console.log('üìç Origem:', window.location.origin);
        console.log('üìç Base URL:', baseUrl);
    </script>
</body>
</html>
